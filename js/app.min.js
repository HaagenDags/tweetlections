!function(){function a(){J.history({channel:I,count:1000,callback:function(a){J.each(a[0],f),b()},error:function(a){console.log(a),a&&b()}})}function b(){J.subscribe({channel:I,callback:f})}function c(a,b){if(a.geo){var c={};if(c.lat=a.geo.coordinates[0],c.lon=a.geo.coordinates[1],0!==c.lat||0!==c.lon){var d=a.place.full_name;c.city=d,c.state=d.substring(d.lastIndexOf(",")+1).trim(),c.name=a.user.name,c.screenname=a.user.screen_name,c.avatar=a.user.profile_image_url,c.tweet=a.text,c.id_str=a.id_str;var e=new Date(parseInt(a.timestamp_ms)),f=e.toDateString().substr(4),g=e.getHours()>12?e.getHours()-12+":"+e.getMinutes()+" PM":e.getHours()+":"+e.getMinutes()+" AM;";c.timestamp=g+" - "+f,console.log(c.tweet),b(c)}}}function d(a){return a.replace(/((https?|s?ftp|ssh)\:\/\/[^"\s\<\>]*[^.,;'">\:\s\<\>\)\]\!])/g,function(a){return'<a href="'+a+'" >'+a+"</a>"})}function e(a,b){c(a,function(a){if(document.querySelector(".emotion").style.backgroundImage="url(images/"+b.icon+")",document.querySelector(".button").href="https://twitter.com/"+a.screenname,document.querySelector(".header").style.backgroundImage="url("+a.avatar+")",document.querySelector(".name").textContent=a.name,document.querySelector(".screenname").textContent="@"+a.screenname,document.querySelector(".text").innerHTML=twemoji.parse(d(a.tweet)),document.querySelector(".timestamp").textContent=a.timestamp,document.querySelector(".reply").href="https://twitter.com/intent/tweet?in_reply_to="+a.id_str,document.querySelector(".retweet").href="https://twitter.com/intent/retweet?tweet_id="+a.id_str,document.querySelector(".favorite").href="https://twitter.com/intent/favorite?tweet_id="+a.id_str,document.querySelector(".tweet").style.opacity=.9,document.querySelector("."+a.state)){i[a.state]=i[a.state]||{democratic:0,republican:0},i[a.state][b.type]=(i[a.state][b.type]||0)+1;var c=document.querySelector("."+a.state);c.style.fill=i[a.state].democratic>i[a.state].republican?j:i[a.state].democratic<i[a.state].republican?k:l,c.setAttribute("data-democratic",i[a.state].democratic),c.setAttribute("data-republican",i[a.state].republican)}var e=C([a.lon,a.lat]);null!==e&&H.enter().append("svg:image").attr("xlink:href","images/"+b.icon).attr("width","26").attr("height","26").attr("transform",function(){return"translate("+e+")"})})}function f(a){a&&a.place&&a.lang&&"US"===a.place.country_code&&(t.some(function(b){return a.text.toLowerCase().indexOf(b)>0})?e(a,m):u.some(function(b){return a.text.toLowerCase().indexOf(b)>0})?e(a,n):v.some(function(b){return a.text.toLowerCase().indexOf(b)>0})?e(a,o):w.some(function(b){return a.text.toLowerCase().indexOf(b)>0})?e(a,p):x.some(function(b){return a.text.toLowerCase().indexOf(b)>0})?e(a,q):y.some(function(b){return a.text.toLowerCase().indexOf(b)>0})?e(a,r):z.some(function(b){return a.text.toLowerCase().indexOf(b)>0})&&e(a,s))}var g=!0,h=document.getElementById("toggle");h.addEventListener("click",function(){g?(J.unsubscribe({channel:I}),h.value="Stream Again",g=!1):(a(),h.value="Stop Twitter Stream!",g=!0)},!1);var i={},j="#3143E0",k="#DA1D1D",l="#DECEB3",m={type:"democratic",icon:"clinton-face.png"},n={type:"democratic",icon:"sanders-face.png"},o={type:"republican",icon:"trump-face.png"},p={type:"republican",icon:"trump-face.png"},q={type:"republican",icon:"kasich-face.png"},r={type:"republican",icon:"rubio-face.png"},s={type:"republican",icon:"cruz-face.png"},t=["clinton","hillary clinton","hilary clinton","hillaryclinton","president clinton","female president","first female president","candidate clinton","hillary for america","solutions for america"],u=["sanders","bernie sanders","bernie","berniesanders","president sanders","bernie for president","feel the bern","candidate sanders","a political revolution is coming"],v=["trump","donald trump","donaldtrump","president trump","candidate trump","make america great again"],w=["trump","donald trump","donaldtrump","president trump","candidate trump","make america great again"],x=["kasich","john kasich","johnkasich","president kasich","candidate kasich","kasich for president","k for us"],y=["rubio","marco rubio","marcorubio","president rubio","candidate rubio","rubio for president","a new american century"],z=["tedcruz","ted cruz","president cruz","candidate cruz","cruz for president","reigniting the promise of america"],A=900,B=540,C=d3.geo.albersUsa(),D=d3.scale.linear().domain([0,15]).range(["#5b5858","#4f4d4d","#454444","#323131"]),E=d3.select("#map").append("svg").attr("width",A).attr("height",B),F=d3.geo.path().projection(C),G=E.append("g");d3.json("json/us-states.json",function(a,b){G.selectAll("path").data(topojson.feature(b,b.objects.usStates).features).enter().append("path").attr("class",function(a){return"states "+a.properties.STATE_ABBR}).attr("d",F).attr("fill",function(a,b){return D(b)})});var H=E.selectAll("image").data([0]),I="pubnub-twitter",J=PUBNUB.init({subscribe_key:"sub-c-78806dd4-42a6-11e4-aed8-02ee2ddab7fe"});a()}();